
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lammen veden lämpeneminen &#8212; Fysiikka</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/translation_fi.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://opendata-education.github.io/Fysiikka/intro.html/harjoitukset/veden-lampeneminen.html" />
    <link rel="shortcut icon" href="../_static/logo.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CMS ja avoin data" href="cms-esimerkki.html" />
    <link rel="prev" title="Taivasta kartoittamassa - mitä näemme yllämme?" href="taivasta-kartoittamassa.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Fysiikka</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Tervetuloa avoimen datan pariin
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Harjoitukset
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="taivasta-kartoittamassa.html">
   Taivasta kartoittamassa - mitä näemme yllämme?
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Lammen veden lämpeneminen
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Hiukkasfysiikka
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="cms-esimerkki.html">
   CMS ja avoin data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cms-animaatio.html">
   CMS animaatio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cms-sovite.html">
   Funktion sovittaminen histogrammiin
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/harjoitukset/veden-lampeneminen.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/opendata-education/Fysiikka"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/opendata-education/Fysiikka/issues/new?title=Issue%20on%20page%20%2Fharjoitukset/veden-lampeneminen.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/opendata-education/Fysiikka/main?urlpath=tree/materiaali/harjoitukset/veden-lampeneminen.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/opendata-education/Fysiikka/blob/main/materiaali/harjoitukset/veden-lampeneminen.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#malli">
   Malli
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#valon-absorboituminen">
     Valon absorboituminen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#johtuminen">
     Johtuminen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#veden-lampotila">
     Veden lämpötila
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#koodi">
   Koodi
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Lammen veden lämpeneminen</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#malli">
   Malli
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#valon-absorboituminen">
     Valon absorboituminen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#johtuminen">
     Johtuminen
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#veden-lampotila">
     Veden lämpötila
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#koodi">
   Koodi
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="lammen-veden-lampeneminen">
<h1>Lammen veden lämpeneminen<a class="headerlink" href="#lammen-veden-lampeneminen" title="Permalink to this headline">¶</a></h1>
<p>Tässä harjoituksessa tarkoituksena on mallintaa (samean) lammen veden lämpenemistä keväällä, lumen sulamisen jälkeen, kun päivän pituus on 10h, ja veden lämpötila pinnan läheisyydessä on vakio 10˚C. Ideana on tehdä fysikaalisesti uskottava malli, jossa ainoa huomiotta jätettävä ilmiö on konvektio. Lämpötilatarkastelu tehdään ajan lisäksi syvyyden funktiona (oletetaan lampi laajaksi eikä reunoja oteta huomioon). Tavoitteena on luoda malli, jonka tulokset noudattavat kohtuullisissa määrin omaa kokemustamme lampien veden lämpenemisestä keväisin, vaikka konvektio merkittävä ilmiö veden lämpötilan muuttumisessa onkin. Mallinnettava ongelma on myös käytännössä mielekäs, sillä lampien ja järvien lämpötiloilla on merkitystä esimerkiksi siinä, miten niissä eliölajit menestyvät, mikä on vaikkapa kalastamisen tai ekosysteemien tutkimuksen kannalta tärkeää.</p>
<div class="section" id="malli">
<h2>Malli<a class="headerlink" href="#malli" title="Permalink to this headline">¶</a></h2>
<p>Tarkastellaan veden lämpenemistä laajassa, tasasyvyisessä lammessa. Oletetaan myös, että Aurinko paistaa vuorokaudessa 10 tuntia ja tuona aikana auringonvalon kulma vedenpinnan kanssa vaihtelee välillä <span class="math notranslate nohighlight">\(\left[\frac{\pi}{8},\frac{7\pi}{8}\right]\)</span> tasaisesti. Auringonvalon sisältämä energia absorboituu veteen, jolloin vesi lämpiää. Vesi lämpiää enemmän pinnasta, jolloin syvemmälle jäänyt vesi on kylmempää kuin pintavesi ja lämpö alkaa siirtyä vesikerroksesta toiseen johtumalla. Todellisuudessa vesi myös sekoittuu, mikä vaikuttaa kerrosten lämpötiloihin merkittävästi, mutta mallin yksinkertaistamiseksi jätetään tämä konvektion vaikutus huomiotta. Tarkoitus on siis mallintaa lammen veden lämpötilaa veden syvyyden <span class="math notranslate nohighlight">\(h\)</span> ja ajan <span class="math notranslate nohighlight">\(t\)</span> funktiona.</p>
<div class="section" id="valon-absorboituminen">
<h3>Valon absorboituminen<a class="headerlink" href="#valon-absorboituminen" title="Permalink to this headline">¶</a></h3>
<p>Oletetaan auringonvalon tulevan tasoaaltoina veden pintaan. Pieni osa valosta heijastuu takaisin ilmaan ja suurempi osa taittuu kuten alla olevassa kuvassa ja jatkaa matkaansa veden alla, jolloin vesi absorboi valoa ja lämpenee. Tarkastellaan tätä kahdessa eri tilanteessa: ensimmäisessä veden sameus pysyy vakiona ja toisessa sameus muuttuu lineaarisesti syvemmälle mentäessä. Todellisuudessa veden taitekerroin ja absorbtiokerroin riippuvat molemmat veden sameudesta, mutta yksinkertaistuksen vuoksi oletetaan vain absorptiokertoimen muuttuvan sameuden muuttuessa, sillä taitekertoimen muuttuminen on hyvin pientä. Taitekerroin riippuu myös veden lämpötilasta, mutta sen vaikutus on tarkasteltavalla lämpötilavälillä myös niin pieni, että jätetään se huomiotta. Kun taitekerroin on sama jokaisessa kerroksessa, valonsäteen kulma muuttuu ainoastaan sen tullessa ilmasta veteen. Taittuneen valon kulma saadaan Snellin lain avulla (2):</p>
<div class="math notranslate nohighlight">
\[n_1\sin{\beta_1}=n_2\sin{\beta_2}\]</div>
<div class="math notranslate nohighlight">
\[\rightarrow\beta_2=\sin^{-1}{\left(\frac{n_1}{n_2}\sin{\beta_1}\right)}\]</div>
<p><img alt="" src="../_images/taittuminen.png" /></p>
<p>Koska vesimassan lämpötila muuttuu vain syvyyssuunnassa, olemme kiinnostuneita vesikerrokseen tulevan valon intensiteetin z-suuntaisesta komponentista (leveys- ja pituussuuntien komponentit ovat merkityksettömiä, koska lammen oletetaan olevan todella leveä)</p>
<div class="math notranslate nohighlight">
\[I_z=I_0\cos{\beta_2}\]</div>
<p>Lammen vesi ja vedessä olevat epäpuhtaudet absorboivat valoa, jolloin valon intensiteetti vaimenee syvemmälle mentäessä. Valon intensiteetin muutos syvyyden muuttuessa riippuu veden absorptiokertoimesta <span class="math notranslate nohighlight">\(a\)</span>, joka voi itsessään olla veden syvyyden funktio. Nyt saadaan differentiaaliyhtälö</p>
<div class="math notranslate nohighlight">
\[dI=-aIdh\]</div>
<div class="math notranslate nohighlight">
\[\rightarrow\int_{I_0}^{I}\frac{dI}{I}=\int_{0}^{h}-adh\]</div>
<div class="math notranslate nohighlight">
\[\rightarrow \ln{I}-\ln{I_0}=-ah\]</div>
<div class="math notranslate nohighlight">
\[\rightarrow I=I_0e^{-ah}\]</div>
<p>Yllä oleva yhtälö tunnetaan myös Beerin ja Lambertin lakina. Kun yhdistetään edellä mainitut kaavat saadaan z-suuntaiselle intensiteetille kaava valon tulokulman ja veden syvyyden funktiona</p>
<div class="math notranslate nohighlight">
\[I_z = I_0\cos{\left(\sin^{-1}\left(\frac{n_1}{n_2}\sin{\beta_1}\right)\right)}e^{-ah}\]</div>
<p>Kyseessä on siis läpäisevän valon intensiteetti, joten vesikerrokseen absorboituneen valon intensiteetti saadaan kerrokseen tulevan valon ja sen läpäisevän valon intensiteettien erotuksena:</p>
<div class="math notranslate nohighlight">
\[I_{abs}=I_0\cos{\left(\sin^{-1}\left(\frac{n_1}{n_2}\sin{\beta_1}\right)\right)}(1-e^{-ah})\]</div>
</div>
<div class="section" id="johtuminen">
<h3>Johtuminen<a class="headerlink" href="#johtuminen" title="Permalink to this headline">¶</a></h3>
<p>Koska konvektiota ei oteta huomioon, voidaan veden ajatella olevan ”hyytelöä” ja koostuvan alla olevan kuvan mukaisesti pienistä vesikerroksista, joiden paksuus on <em>dh</em> ja jotka eivät sekoitu keskenään. Kerrokset on jaettu syvyyssuuntaisesti, jolloin lämpötila pysyy vakiona vaakasuunnissa: valon absorptiossa tehty tasoaaltoapproksimaatio takaa sen, että lampi myös lämpenee auringon vaikutuksesta tasaisesti leveys- ja pituussuunnissa, kun reunojen lämmönjohtumista ei huomioida. Lämmönjohtumisessa siirtyvä lämpöenergian määrä voidaan laskea Fourier’n lain avulla:</p>
<div class="math notranslate nohighlight">
\[q=-k\Delta T=-k\left(\frac{\partial T}{\partial x}+\frac{\partial T}{\partial y}+\frac{\partial T}{\partial z}\right)=-k\frac{dT}{dz}=-k\frac{dT}{dh}\]</div>
<p><img alt="" src="../_images/kerrokset.png" /></p>
<p>Vierekkäiset vesikerrokset vaihtavat lämpöä suuremmasta lämpötilasta pienempään. Siirtyneen lämpöenergian  aiheuttama lämpötilan muutos tarkasteltavassa vesikerroksessa voidaan laskea veden ominaislämpökapasiteetin avulla:</p>
<div class="math notranslate nohighlight">
\[q=mcdT_{kerros}=-k\frac{dT}{dh}\]</div>
<div class="math notranslate nohighlight">
\[\rightarrow dT_{kerros} = \frac{-k}{mc}\frac{dT}{dh}\]</div>
<p>Huomioitavaa on, että <span class="math notranslate nohighlight">\(dT_{kerros}\)</span> tarkoittaa tarkasteltavan vesikerroksen lämpötilan muutosta, kun taas <span class="math notranslate nohighlight">\(dT\)</span> tarkoittaa naapurikerroksen ja tarkasteltavan kerroksen välistä lämpötilaeroa. Huomattavaa on myös, että pohja- ja pintakerroksilla tämä kerroin on eri, sillä pinnalla lämmönvaihtoa tapahtuu ilman kanssa, ja pohjassa pohjan kanssa. Järven pohjan lämpötila on oletettu vakio +4˚C:ksi, sillä vaikka konvektiota ei sinänsä huomioida, tiedetään järvien pohjien olevan aina tämän lämpöisiä, sillä sen lämpöinen vesi on raskainta. Järven pohjan voidaan myös olettaa olevan kivinen, jolloin se ei muutenkaan lämpenisi kovin nopeasti.</p>
</div>
<div class="section" id="veden-lampotila">
<h3>Veden lämpötila<a class="headerlink" href="#veden-lampotila" title="Permalink to this headline">¶</a></h3>
<p>Kun veden lämpötilaan vaikuttavat tekijät on huomioitu, voidaan johtaa kaava vesikerroksen lämpötilan laskemiseksi. Jaetaan tarkasteltava ajanjakso lyhyisiin, <span class="math notranslate nohighlight">\(dt\)</span>:n  mittaisiin hetkiin. Jokaisen lyhyen hetken jälkeen vesikerroksen lämpötila määräytyy kerroksen alkuperäisen lämpötilan, vierekkäisten kerroksien kanssa vaihdettavan lämmön sekä absorboituneen valon tuoman energian mukaan kuten alla olevassa kuvassa. Kerroksen lämpötila hetken <span class="math notranslate nohighlight">\(dt\)</span> kuluttua on siis:</p>
<div class="math notranslate nohighlight">
\[T=T_0+I_{abs}dt+dT_{yläkerros}dt+dT_{alakerros}dt\]</div>
<p><img alt="" src="../_images/energiansiirto.png" /></p>
<p>Lopullinen malli muodostuu, kun iteroidaan <span class="math notranslate nohighlight">\(dt\)</span>:n pituisia ajanjaksoja siten, että saadaan laskettua veden lämpötila syvyyden funktiona useiden vuorokausien ajalta.</p>
</div>
</div>
<div class="section" id="koodi">
<h2>Koodi<a class="headerlink" href="#koodi" title="Permalink to this headline">¶</a></h2>
<p>Simulaation koodi on kirjoitettu alla olevaan koodisoluun. Solun alussa olevia parametreja muuttamalla voidaan tarkastella eri tilanteita muuttamalla mm. tarkasteltavaa aika väliä, veden sameuskertoimia tai veden alkulämpötiloja.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import needed modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define initial parameters</span>
<span class="n">t_end</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mi">7</span> <span class="c1"># how long simulation in time in h. HAVE TO BE 10h or n*24h</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time step in h</span>
<span class="n">day</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># length of day in h (time that sun is up)</span>
<span class="n">depth</span> <span class="o">=</span> <span class="mi">6</span> <span class="c1"># depth of lake in m</span>
<span class="n">dz</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># step of depth vector in m</span>
<span class="n">T_air</span><span class="o">=</span> <span class="mi">10</span> <span class="o">+</span><span class="mf">273.15</span> <span class="c1"># air temperature in K</span>
<span class="n">T_bottom</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span><span class="mf">273.15</span> <span class="c1"># rock temperature in bottom of the lake in K</span>
<span class="n">T_water_surface</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span><span class="mf">273.15</span> <span class="c1"># Initial water surface temperature in K</span>
<span class="n">T_water_bottom</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span><span class="mf">273.15</span> <span class="c1"># Initial water bottom temperature in K</span>

<span class="c1"># Define constants</span>
<span class="n">I0</span> <span class="o">=</span> <span class="mi">665</span> <span class="c1"># solar constant J/m^2/s</span>
<span class="n">C_water</span> <span class="o">=</span> <span class="mi">4186</span> <span class="c1"># heat capacity of water J/kg/K</span>
<span class="n">a_water_top</span> <span class="o">=</span> <span class="mf">0.35</span> <span class="c1"># extinction coefficient for water on the top</span>
<span class="n">a_water_bottom</span> <span class="o">=</span> <span class="mf">0.35</span> <span class="c1"># extinction coefficient for water on the bottom</span>
<span class="n">k_water</span> <span class="o">=</span> <span class="mf">0.585</span> <span class="c1"># thermal conductivity of water</span>
<span class="n">k_air_water</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="mf">0.03</span> <span class="c1"># thermal conductivity of air-water interface</span>
<span class="n">k_water_rock</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="c1"># thermal conductivity of water_rock interface in the bottom of the lake</span>
<span class="n">n_air</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># refractive index of air</span>
<span class="n">n_water</span><span class="o">=</span><span class="mf">1.33</span> <span class="c1"># refractive index of water</span>

<span class="c1"># Time vector and sun angle step</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_end</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
<span class="n">d_angle</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="n">day</span><span class="o">*</span><span class="n">dt</span>

<span class="c1"># Define angle vector that has sun angle for each time step</span>
<span class="k">if</span> <span class="n">t_end</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">t_end</span><span class="o">/</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="n">d_angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="mi">14</span><span class="o">/</span><span class="n">dt</span><span class="p">))))),</span><span class="n">n</span><span class="p">)</span>                                                              
<span class="k">else</span><span class="p">:</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="n">d_angle</span><span class="p">)</span>
    
<span class="c1"># Depth and water extinction vector</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
<span class="n">a_water</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">a_water_top</span><span class="p">,</span><span class="n">a_water_bottom</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>

<span class="c1"># Mass of water of slice height dz with area 1m^2 in kg</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">dz</span><span class="o">*</span><span class="mi">1000</span> 

<span class="c1"># Temperature matrix</span>
<span class="n">T_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
<span class="c1"># Initial condition for temperature distribution</span>
<span class="n">T_matrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_water_surface</span><span class="p">,</span><span class="n">T_water_bottom</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> 

<span class="c1"># Calculation of energy flows and new temperatures of different depth points in time.</span>
<span class="c1"># Temperatures are saved to T_matrix.</span>

<span class="c1"># Loop all time steps</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="c1"># Calculate light intensity that goes into water</span>
    <span class="n">I_in</span> <span class="o">=</span> <span class="n">I0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">n_air</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="n">angle</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="n">n_water</span><span class="p">))</span> <span class="c1"># z-component of light </span>
    <span class="k">if</span> <span class="n">angle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">reflectance</span> <span class="o">=</span> <span class="mf">0.03</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reflectance</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># During night there is no energy from sun</span>
    <span class="n">I_in</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">reflectance</span><span class="p">)</span><span class="o">*</span><span class="n">I_in</span> <span class="c1"># attenuation due reflection</span>
    
    <span class="c1"># Loop all depth steps</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)):</span>
        
        <span class="n">I_pass</span> <span class="o">=</span> <span class="n">I_in</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a_water</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">dz</span><span class="p">)</span>
        <span class="n">I_absorbed</span> <span class="o">=</span> <span class="n">I_in</span><span class="o">-</span><span class="n">I_pass</span> <span class="c1"># absorbed light</span>
        <span class="n">E_light</span> <span class="o">=</span> <span class="n">I_absorbed</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span> <span class="c1"># energy of light absorbed in dt to the area of 1m^2</span>
        
        <span class="c1"># air-water surface</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">Q_up</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_air_water</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_air</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat from upper slice</span>
            <span class="n">Q_down</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_water</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat to down slice</span>
            <span class="n">T_new</span> <span class="o">=</span> <span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">E_light</span><span class="o">+</span><span class="n">Q_up</span><span class="o">+</span><span class="n">Q_down</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C_water</span><span class="o">*</span><span class="n">mass</span><span class="p">)</span>

        
        <span class="c1"># water-lakebottom surface</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">Q_up</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_water</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat from upper slice</span>
            <span class="n">Q_down</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_water_rock</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_bottom</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat to down slice</span>
            <span class="n">T_new</span> <span class="o">=</span> <span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">E_light</span><span class="o">+</span><span class="n">Q_up</span><span class="o">+</span><span class="n">Q_down</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C_water</span><span class="o">*</span><span class="n">mass</span><span class="p">)</span>

        <span class="c1"># other layers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Q_up</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_water</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat from upper slice</span>
            <span class="n">Q_down</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_water</span><span class="o">*</span><span class="p">(</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="mi">3600</span><span class="o">/</span><span class="n">dz</span> <span class="c1"># heat to down slice</span>
            <span class="n">T_new</span> <span class="o">=</span> <span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">E_light</span><span class="o">+</span><span class="n">Q_up</span><span class="o">+</span><span class="n">Q_down</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C_water</span><span class="o">*</span><span class="n">mass</span><span class="p">)</span>
        
        <span class="n">T_matrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">T_new</span>
        <span class="n">I_in</span> <span class="o">=</span> <span class="n">I_pass</span> <span class="c1"># setting for new iteration</span>
        
<span class="c1"># Plot the results</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="n">X</span><span class="p">,</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">T_matrix</span><span class="o">-</span><span class="mf">273.15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Depth(m)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time(h)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Temperature(Celcius)&#39;</span><span class="p">)</span>
<span class="c1">#ax.invert_yaxis() # CAUSES BUG</span>
<span class="n">ax</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/veden-lampeneminen_6_0.png" src="../_images/veden-lampeneminen_6_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./harjoitukset"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="taivasta-kartoittamassa.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Taivasta kartoittamassa - mitä näemme yllämme?</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="cms-esimerkki.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">CMS ja avoin data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By HIP Education and Open Data Team<br/>
    
      <div class="extra_footer">
        <div>
<a>Toteutettu Opetushallituksen valtionavustuksella tiedekasvatuksen edistämiseen.</a></br><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img class="license" alt="Creative Commons License" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a> Tämän sivuston materiaali on käytettävissä seuraavalla lisenssillä: <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC-BY 4.0.</a>
</div>    

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>